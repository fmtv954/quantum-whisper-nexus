V2 Document 2.2: Tech Stack Specification

CONTEXT

Following the System Architecture Deep Dive, development teams need precise technology specifications, versions, and configuration details to implement the platform exactly as architected.

OBJECTIVE

Provide comprehensive tech stack documentation with exact versions, configuration patterns, and implementation standards for consistent development.

STYLE

Technical specification with code examples, version pinning, and configuration templates. Reference official documentation where applicable.

TONE

Precise, authoritative, and implementation-focused. Every detail should be actionable.

AUDIENCE

Developers, DevOps engineers, technical leads implementing the platform.

RESPONSE FORMAT

Markdown with code blocks, version tables, configuration templates, and package specifications.

CONSTRAINTS

Â· Must use exact versions for reproducibility
Â· Must include both development and production configurations
Â· Must reference official documentation
Â· Must align with cost optimization goals

FEW-SHOT EXAMPLES

Reference: System architecture, quick start guide, and previous tech stack outlines.

TASK

Generate complete tech stack specification covering:

1. Version-Controlled Dependencies
2. Development Environment Setup
3. Production Configuration
4. AI Service Configurations
5. Database & Cache Setup
6. Deployment Specifications

VERIFICATION CHECKPOINT

Developer should be able to recreate the exact development environment from this document.

ROLLBACK INSTRUCTIONS

Document deprecated versions and migration paths for each technology.

COMMON ERRORS & FIXES

Â· Version conflicts â†’ Exact version pinning
Â· Configuration drift â†’ Environment templates
Â· Service compatibility â†’ Tested version matrices

NEXT STEP PREPARATION

This enables Document 3.1: Voice AI Pipeline Architecture implementation.

---

Quantum Voice AI - Tech Stack Specification

1. Version-Controlled Dependencies

1.1 Core Framework & Runtime

```json
{
  "dependencies": {
    "next": "14.0.4",
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "typescript": "5.3.3",
    "@types/node": "20.10.5",
    "@types/react": "18.2.45",
    "@types/react-dom": "18.2.18"
  }
}
```

Rationale: Next.js 14 provides App Router stability, React 18 concurrent features, TypeScript 5.3 for better performance.

1.2 AI & Voice Services

```json
{
  "dependencies": {
    "@deepgram/sdk": "2.7.0",
    "openai": "4.20.1",
    "@google/generative-ai": "0.8.1",
    "livekit-server-sdk": "1.6.1",
    "livekit-client": "1.6.1",
    "tavily": "1.0.2"
  }
}
```

Version Justification:

Â· Deepgram SDK 2.7.0: Stable with Nova-3 and Aura TTS
Â· OpenAI 4.20.1: Supports GPT-4-mini and streaming
Â· LiveKit 1.6.1: Production-ready WebRTC with audio optimizations

1.3 Data Layer

```json
{
  "dependencies": {
    "@supabase/supabase-js": "2.38.1",
    "redis": "4.6.10",
    "@upstash/redis": "1.22.1",
    "pg": "8.11.3"
  }
}
```

1.4 UI & Styling

```json
{
  "dependencies": {
    "tailwindcss": "3.3.6",
    "clsx": "2.0.0",
    "lucide-react": "0.294.0",
    "framer-motion": "10.16.5",
    "recharts": "2.8.0"
  },
  "devDependencies": {
    "@tailwindcss/forms": "0.5.7",
    "@tailwindcss/typography": "0.5.10",
    "autoprefixer": "10.4.16",
    "postcss": "8.4.32"
  }
}
```

---

2. Development Environment Setup

2.1 Node.js & Package Manager

```bash
# Required Node.js version
node --version  # Must be 18.17.0 or higher
npm --version   # 9.6.7 or higher

# Alternative: Use pnpm for faster installs
corepack enable pnpm
pnpm --version  # 8.14.0 or higher
```

2.2 Environment Template (.env.local)

```bash
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...

# AI Services
DEEPGRAM_API_KEY=your_deepgram_api_key_here
OPENAI_API_KEY=sk-your_openai_key_here
GOOGLE_API_KEY=your_gemini_key_here
TAVILY_API_KEY=your_tavily_key_here

# LiveKit WebRTC
LIVEKIT_API_KEY=your_livekit_api_key
LIVEKIT_API_SECRET=your_livekit_secret
NEXT_PUBLIC_LIVEKIT_URL=wss://your-project.livekit.cloud

# Redis (Upstash)
UPSTASH_REDIS_REST_URL=https://eu1-shiny-bird-12345.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_redis_token

# Integration Services
ASANA_ACCESS_TOKEN=your_asana_token
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...
RESEND_API_KEY=your_resend_key

# Application Settings
NEXTAUTH_SECRET=your_nextauth_secret
NEXTAUTH_URL=http://localhost:3000
```

2.3 Development Scripts (package.json)

```json
{
  "scripts": {
    "dev": "next dev --turbo",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:e2e": "playwright test",
    "db:push": "supabase db push",
    "db:reset": "supabase db reset",
    "studio": "supabase studio"
  }
}
```

---

3. Production Configuration

3.1 Next.js Configuration (next.config.js)

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    serverComponentsExternalPackages: ['@deepgram/sdk', 'livekit-server-sdk']
  },
  
  // Image optimization
  images: {
    domains: ['your-supabase-project.supabase.co'],
    formats: ['image/avif', 'image/webp'],
  },
  
  // Audio handling
  webpack: (config) => {
    config.module.rules.push({
      test: /\.(ogg|mp3|wav|m4a)$/,
      use: {
        loader: 'file-loader',
        options: {
          publicPath: '/_next/static/sounds/',
          outputPath: 'static/sounds/',
          name: '[name]-[hash].[ext]',
        },
      },
    });
    return config;
  },
  
  // Security headers
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-XSS-Protection',
            value: '1; mode=block',
          },
        ],
      },
    ];
  },
};

module.exports = nextConfig;
```

3.2 Tailwind CSS Configuration

```javascript
// tailwind.config.js
module.exports = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        'space-black': '#000000',
        'matrix-blue': '#00D4FF', 
        'cyber-green': '#00FF88',
        'electric-purple': '#8B5CF6',
        'carbon-gray': '#1A1A1A',
        'steel': '#2D2D2D',
      },
      fontFamily: {
        'inter': ['Inter', 'sans-serif'],
        'mono': ['JetBrains Mono', 'monospace'],
      },
      animation: {
        'pulse-glow': 'pulse-glow 2s infinite',
        'hologram': 'hologram 3s ease-in-out infinite',
      },
      keyframes: {
        'pulse-glow': {
          '0%, 100%': { boxShadow: '0 0 5px rgba(0, 212, 255, 0.5)' },
          '50%': { boxShadow: '0 0 20px rgba(0, 212, 255, 0.8)' },
        },
        'hologram': {
          '0%, 100%': { opacity: 0.8 },
          '50%': { opacity: 1 },
        },
      },
    },
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('@tailwindcss/typography'),
  ],
};
```

---

4. AI Service Configurations

4.1 Deepgram STT Configuration

```typescript
// lib/deepgram.ts
import { Deepgram } from '@deepgram/sdk';

const deepgram = new Deepgram(process.env.DEEPGRAM_API_KEY);

export const deepgramConfig = {
  model: 'nova-3', // $0.0077/min - best accuracy/cost balance
  tier: 'enhanced', // Better noise handling
  language: 'en-US',
  punctuate: true,
  interim_results: true,
  endpointing: 500, // End of speech detection (ms)
  vad_events: true, // Voice activity detection
  
  // Cost optimization
  smart_format: true, // Reduces processing time
  numerals: true, // Better number recognition
};
```

4.2 OpenAI GPT Configuration

```typescript
// lib/openai.ts
import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export const openaiConfig = {
  model: 'gpt-4-1106-preview', // GPT-4-mini - $0.15/1M tokens input
  max_tokens: 500, // Limit response length for cost control
  temperature: 0.7, // Balance creativity vs consistency
  top_p: 0.9,
  
  // Cost tracking
  user: 'customer-id', // For usage tracking per customer
  stream: true, // Better user experience
};

export const openaiFallbackConfig = {
  model: 'gpt-4-1106-preview', // GPT-4.1-mini for complex queries
  max_tokens: 800,
  temperature: 0.5, // More deterministic for complex answers
};
```

4.3 LiveKit WebRTC Configuration

```typescript
// lib/livekit.ts
import { Room, RoomEvent } from 'livekit-client';

export const livekitConfig = {
  audio: {
    noiseSuppression: true,
    echoCancellation: true,
    autoGainControl: true,
  },
  video: false, // Audio-only for cost optimization
  adaptiveStream: true, // Network optimization
  
  // Cost controls
  dynacast: true, // Bandwidth optimization
  simulcast: false, // Not needed for audio-only
};

// Server-side configuration
export const livekitServerConfig = {
  maxParticipants: 2, // AI + User only
  emptyTimeout: 30, // Seconds before closing empty room
  maxDuration: 3600, // 1 hour max call length
};
```

---

5. Database & Cache Setup

5.1 Supabase Schema Configuration

```sql
-- Enable required extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- Core tables with RLS
CREATE TABLE campaigns (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  status VARCHAR(50) DEFAULT 'draft',
  voice_settings JSONB DEFAULT '{}',
  flow_config JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

ALTER TABLE campaigns ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own campaigns" ON campaigns
  FOR ALL USING (auth.uid() = owner_id);

-- Conversations table with partitioning
CREATE TABLE conversations (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  campaign_id UUID REFERENCES campaigns(id),
  customer_email VARCHAR(255),
  transcript_summary TEXT,
  full_transcript TEXT,
  lead_data JSONB,
  cost_data JSONB,
  duration INTEGER, -- seconds
  created_at TIMESTAMPTZ DEFAULT NOW()
) PARTITION BY RANGE (created_at);
```

5.2 Redis Session Configuration

```typescript
// lib/redis.ts
import { Redis } from 'redis';

const redis = new Redis({
  url: process.env.UPSTASH_REDIS_REST_URL,
  token: process.env.UPSTASH_REDIS_REST_TOKEN,
});

export const redisConfig = {
  // Session management
  sessionTTL: 3600, // 1 hour
  conversationTTL: 86400, // 24 hours for active conversations
  
  // Cache settings
  cacheTTL: {
    knowledgeBase: 1800, // 30 minutes
    userSettings: 3600, // 1 hour
    campaignConfig: 900, // 15 minutes
  },
};
```

---

6. Deployment Specifications

6.1 Vercel Configuration (vercel.json)

```json
{
  "version": 2,
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "functions": {
    "app/api/**/*.ts": {
      "maxDuration": 30,
      "memory": 1024
    }
  },
  "env": {
    "NEXT_PUBLIC_SUPABASE_URL": "@supabase-url",
    "SUPABASE_SERVICE_ROLE_KEY": "@supabase-service-role-key",
    "DEEPGRAM_API_KEY": "@deepgram-api-key",
    "OPENAI_API_KEY": "@openai-api-key"
  },
  "regions": ["iad1"],
  "build": {
    "env": {
      "NEXT_PUBLIC_VERCEL_ENV": "production"
    }
  }
}
```

6.2 Environment Variables for Production

```bash
# Vercel Environment Variables
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-app.vercel.app

# Security
NEXTAUTH_SECRET=@nextauth-secret
NEXTAUTH_URL=https://your-app.vercel.app

# Monitoring
NEXT_PUBLIC_POSTHOG_KEY=your_posthog_key
NEXT_PUBLIC_CRISP_WEBSITE_ID=your_crisp_id
```

6.3 Performance Optimization

```typescript
// lib/performance.ts
export const performanceConfig = {
  // Image optimization
  imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
  
  // Bundle optimization
  chunkSize: 1024 * 1024, // 1MB chunks
  compress: true,
  
  // Cache headers
  cacheControl: {
    static: 'public, max-age=31536000, immutable',
    dynamic: 'public, max-age=3600, stale-while-revalidate=86400',
  },
};
```

---

7. Testing & Quality Assurance

7.1 Testing Stack

```json
{
  "devDependencies": {
    "jest": "29.7.0",
    "@testing-library/react": "13.4.0",
    "@testing-library/jest-dom": "6.1.4",
    "@playwright/test": "1.40.1",
    "msw": "1.3.2"
  }
}
```

7.2 Test Configuration

```javascript
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/$1',
  },
  collectCoverageFrom: [
    'app/**/*.{js,jsx,ts,tsx}',
    'components/**/*.{js,jsx,ts,tsx}',
    'lib/**/*.{js,jsx,ts,tsx}',
    '!**/*.d.ts',
    '!**/node_modules/**',
  ],
};
```

---

ðŸŽ¯ Verification Checklist

Â· All versions match exactly for reproducible builds
Â· Environment variables template covers all services
Â· Database schema includes proper RLS policies
Â· AI service configurations optimize for cost
Â· Production deployment configuration complete
Â· Testing stack configured for comprehensive coverage

---

ðŸ“š Next Steps

Proceed to Document 3.1: Voice AI Pipeline Architecture for detailed implementation of the AI conversation flow using this exact tech stack.

Related Documents:

Â· 7.1 Production Deployment Guide (operationalizing this stack)
Â· 12.2 Code Standards & Best Practices (development workflow)
Â· 9.1 Comprehensive Troubleshooting Guide (debugging this stack)

---

Generated following CO-STAR framework with exact version pinning and production-ready configurations.

